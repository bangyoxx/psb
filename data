<?php
session_start();

if (!isset($_SESSION['username'])) {
    header('Location: login.html');
    exit();
}

require 'config.php';

$username = $_SESSION['username'];
$role = $_SESSION['role'];
$user_id = $_SESSION['user_id']; // Pastikan user_id disimpan dalam sesi

?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Pendaftaran</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <h1>Data Pendaftaran</h1>
    <a href="home.php">Kembali ke Beranda</a><br><br>

    <?php if ($role == 'admin'): ?>
        <h2>Daftar Semua Pendaftar</h2>
        <?php
        $result = mysqli_query($conn, "SELECT * FROM form");
        if (mysqli_num_rows($result) > 0) {
            echo "<table border='1'>
                    <tr>
                        <th>Nama</th>
                        <th>Asal Sekolah</th>
                        <th>Tempat Lahir</th>
                        <th>Tanggal Lahir</th>
                        <th>Jenis Kelamin</th>
                        <th>Alamat</th>
                        <th>Nomor Telepon</th>
                        <th>Agama</th>
                        <th>Email</th>
                        <th>Program Studi Pilihan</th>
                        <th>Status</th>
                    </tr>";
            while ($row = mysqli_fetch_assoc($result)) {
                echo "<tr>
                        <td>{$row['nama_lengkap']}</td>
                        <td>{$row['asal_sekolah']}</td>
                        <td>{$row['tempat_lahir']}</td>
                        <td>{$row['tanggal_lahir']}</td>
                        <td>{$row['jk']}</td>
                        <td>{$row['alamat']}</td>
                        <td>{$row['nomor_telepon']}</td>
                        <td>{$row['agama']}</td>
                        <td>{$row['email']}</td>
                        <td>{$row['program_studi']}</td>
                        <td>{$row['status']}</td>
                    </tr>";
            }
            echo "</table>";
        } else {
            echo "Tidak ada data pendaftar.";
        }
        ?>
    <?php else: ?>
        <h2>Data Pendaftaran Saya</h2>
        <?php
        // Query untuk mengambil data pendaftaran pengguna yang sedang login
        $result = mysqli_query($conn, "SELECT * FROM form WHERE user_id = '$user_id'");
        if (mysqli_num_rows($result) > 0) {
            while ($row = mysqli_fetch_assoc($result)) {
                echo "Nama: {$row['nama_lengkap']}<br>
                      Asal Sekolah: {$row['asal_sekolah']}<br>
                      Tempat Lahir: {$row['tempat_lahir']}<br>
                      Tanggal Lahir: {$row['tanggal_lahir']}<br>
                      Jenis Kelamin: {$row['jk']}<br>
                      Alamat: {$row['alamat']}<br>
                      Nomor Telepon: {$row['nomor_telepon']}<br>
                      Agama: {$row['agama']}<br>
                      Email: {$row['email']}<br>
                      Program Studi Pilihan: {$row['program_studi']}<br>
                      Status: {$row['status']}<br>";
            }
        } else {
            echo "Tidak ada data pendaftaran Anda.";
        }
        ?>
    <?php endif; ?>
</body>
</html>
